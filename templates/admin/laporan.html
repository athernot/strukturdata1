{% extends 'admin/layout.html' %}
{% block title %}Laporan{% endblock %}

{% block isi %}
<div class="container-fluid px-4">
    <h1 class="mt-4">Laporan</h1>
    <p class="mb-4">Buat dan kelola laporan kinerja atau masalah teknis.</p>

    <div class="row">
        <div class="col-md-6">
            <div class="card shadow-sm border-0 rounded-4">
                <div class="card-body text-center">
                    <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                    <h5 class="card-title">Laporan Kinerja</h5>
                    <p class="card-text text-muted">Buat laporan terkait performa dan pencapaian.</p>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#kinerjaModal">
                        Buat Laporan Kinerja
                    </button>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm border-0 rounded-4">
                <div class="card-body text-center">
                    <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
                    <h5 class="card-title">Laporan Masalah</h5>
                    <p class="card-text text-muted">Laporkan kendala atau masalah teknis yang terjadi.</p>
                     <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#troubleModal">
                        Buat Laporan Masalah
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="kinerjaModal" tabindex="-1" aria-labelledby="kinerjaModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="kinerjaModalLabel">Buat Laporan Kinerja</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="kinerjaForm">
          <div class="mb-3">
            <label for="kinerja-user" class="form-label">Nama User/Divisi</label>
            <input type="text" class="form-control" id="kinerja-user" required>
          </div>
          <div class="mb-3">
            <label for="kinerja-message" class="form-label">Detail Laporan Kinerja</label>
            <textarea class="form-control" id="kinerja-message" rows="4" required></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
        <button type="button" class="btn btn-primary" onclick="submitReport('kinerja')">Kirim Laporan</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="troubleModal" tabindex="-1" aria-labelledby="troubleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="troubleModalLabel">Buat Laporan Masalah</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="troubleForm">
          <div class="mb-3">
            <label for="trouble-location" class="form-label">Lokasi/Departemen</label>
            <input type="text" class="form-control" id="trouble-location" required>
          </div>
          <div class="mb-3">
            <label for="trouble-message" class="form-label">Detail Masalah</label>
            <textarea class="form-control" id="trouble-message" rows="4" required></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
        <button type="button" class="btn btn-danger" onclick="submitReport('trouble')">Kirim Laporan</button>
      </div>
    </div>
  </div>
</div>

<script>
    function submitReport(type) {
        let modalId, formId;
        if (type === 'kinerja') {
            modalId = 'kinerjaModal';
            formId = 'kinerjaForm';
        } else if (type === 'trouble') {
            modalId = 'troubleModal';
            formId = 'troubleForm';
        }

        if (modalId && formId) {
            // Logika untuk mengirim laporan (bisa via AJAX ke server)
            console.log(`Laporan ${type} dikirim.`);

            // Tutup modal dan reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById(modalId));
            if (modal) {
                modal.hide();
            }
            document.getElementById(formId).reset();
            
            // Tampilkan notifikasi flash message (menggunakan logika flash Flask)
            // Karena ini di sisi klien, kita tidak bisa langsung memanggil flash().
            // Alternatifnya adalah menampilkan notifikasi toast atau mengarahkan ulang halaman.
            // Di sini, kita akan mem-flash pesan di sesi (jika ada backend) atau hanya log.
            alert('Laporan berhasil dikirim! (Simulasi)');
        }
    }
</script>
{% endblock %}